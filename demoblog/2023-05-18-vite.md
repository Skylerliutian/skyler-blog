---
slug: vite
title: vite相关
authors: skyler
tags: [前端]
---

最近项目从 _snowpack_ 换成了 _vite_, 在这里记录一下并学习一下前端打包的相关知识

**ESM，CJS 是什么？**

```jsx
// CJS 是commonjs的缩写
// import
const doSomething = require("./doSomething.js");
// export
module.exports = function doSomething() {
  // do something
};

// ESM 即 es6模块
// import
import React from "react";
// export
export default function doSomething() {}
```

CJS:

1. node 中的通用语法
2. 不能在浏览器中运行

ESM：

1. 浏览器中可以运行
2. 支持 tree-shaking
3. <script type=’module’>标签中可用

**打包**：将我们写的浏览器不认识的代码，交给构建工具进行编译处理的过程就叫做打包，打包完成之后会给我们一个浏览器认识的文件。

### **什么是构建工具？**

浏览器只认识 html、css、js。

但是在我们正常的项目开发中可能会用到：

1. typescript：遇到 ts 文件我们需要使用 tsc 将 ts 文件转换成 js 文件。
2. React/Vue：需要安装 react-compiler / vue-compiler，将 jsx 或 .vue 文件转化成 render 函数。
3. less/sass/postcss/component-style：需要安装 less-loader、sass-loader 等一系列编译工具。
4. 语法降级：如果使用的是一些老旧的浏览器，需要安装 babel，将 es 的新语法转换成旧版浏览器可以接受的语法。
5. 体积优化：随着项目的不断发展，功能不断完善，代码量也会随之上升。这时会需要，uglifyjs 或者其他工具将我们的代码进行压缩变成体积更小，性能更高的文件。
6. etc….

项目开发过程中稍微改动一个文件，就需要重复上述的操作。我们希望有一个工具可以将上述的工具全部集成在一起，我们只需要关注代码。这个工具就是**构建工具。**

### 构建工具都做了什么？

1. 模块化开发支持：支持直接从 node_modules 里引用代码 + 多种模块化支持。

   ```html
   <script type="module">
     // esm写法
     import loadsh from "loadsh";
     // commonjs写法
     const loadsh = require("loadsh");
   </script>
   ```

2. 处理代码兼容性：上述说的**代码降级、less / ts / react / vue 语法转换等。**严格来说，不是构建工具做的，是构建工具将这些语法对应的处理工具集成起来，进行自动化的处理。
3. 提高项目性能：打包过程中会**压缩文件**，**代码分割**，
4. 优化开发体验：
   1. 构建工具会帮我们自动监听文件的变化，当文件发生变化时自动帮你调用对应的集成工具进行打包，让后浏览器重新运行（整个过程叫做热更新，HMR，Hot Module Replacement）
   2. 开发服务器：跨域的问题，

**构建工具让我们可以不用关心生产的代码，也不用关心代码怎么在浏览器中运行，只需要专注于代码开发。**

<!-- truncate -->
